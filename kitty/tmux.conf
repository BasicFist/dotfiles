# ═══════════════════════════════════════════════════════════
# 🤖 AI AGENTS COLLABORATION SYSTEM - TMUX CONFIGURATION
# ═══════════════════════════════════════════════════════════
# Optimized for dual-agent workflows with TPM plugin management
# Last Updated: 2025-10-29

# ───────────────────────────────────────────────────────────
# 🎯 Core Settings
# ───────────────────────────────────────────────────────────

# Enable 256 color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Enable mouse support (useful for beginners)
set -g mouse on

# Increase scrollback buffer
set -g history-limit 50000

# Start window/pane numbering at 1 (not 0)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Enable focus events (for vim/neovim)
set -g focus-events on

# Faster command sequences (reduce escape time)
set -sg escape-time 10

# Aggressive resize (useful for multiple clients)
setw -g aggressive-resize on

# ───────────────────────────────────────────────────────────
# ⌨️ Key Bindings
# ───────────────────────────────────────────────────────────

# Remap prefix from Ctrl+B to Ctrl+A (easier to reach)
# Uncomment if you prefer Ctrl+A:
# unbind C-b
# set -g prefix C-a
# bind C-a send-prefix

# Reload config with prefix + r
unbind r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Split panes using | and - (more intuitive)
unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Navigate panes using Alt + arrow keys (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Resize panes using Ctrl + arrow keys
bind -r C-Left resize-pane -L 5
bind -r C-Right resize-pane -R 5
bind -r C-Up resize-pane -U 5
bind -r C-Down resize-pane -D 5

# Switch windows with Shift + arrow keys (no prefix)
bind -n S-Left previous-window
bind -n S-Right next-window

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Synchronize panes (type in all panes at once)
bind S setw synchronize-panes \; display-message "Sync panes: #{?pane_synchronized,ON,OFF}"

# ───────────────────────────────────────────────────────────
# 🎨 Status Bar (Dracula Theme)
# ───────────────────────────────────────────────────────────

# Status bar position
set -g status-position top

# Status bar colors (Dracula palette)
set -g status-style bg=#282a36,fg=#f8f8f2

# Left status: session name
set -g status-left-length 40
set -g status-left "#[bg=#bd93f9,fg=#282a36,bold] 🤖 #S #[bg=#282a36,fg=#bd93f9]"

# Right status: date, time, host
set -g status-right-length 80
set -g status-right "#[fg=#50fa7b]  %Y-%m-%d #[fg=#f8f8f2]│#[fg=#8be9fd] 🕐 %H:%M #[fg=#f8f8f2]│#[fg=#ff79c6] 💻 #H "

# Window status format
setw -g window-status-format "#[fg=#6272a4] #I:#W "
setw -g window-status-current-format "#[bg=#44475a,fg=#50fa7b,bold] #I:#W "

# Pane border colors
set -g pane-border-style fg=#6272a4
set -g pane-active-border-style fg=#bd93f9

# Message colors
set -g message-style bg=#44475a,fg=#f8f8f2,bold

# ───────────────────────────────────────────────────────────
# 🔔 Notifications & Activity
# ───────────────────────────────────────────────────────────

# Monitor activity in other windows
setw -g monitor-activity on
set -g visual-activity off

# Display messages for 2 seconds
set -g display-time 2000

# ───────────────────────────────────────────────────────────
# 📋 Copy Mode (Vi-style)
# ───────────────────────────────────────────────────────────

# Use vi-style key bindings in copy mode
setw -g mode-keys vi

# Enter copy mode with prefix + [
# Start selection with 'v', copy with 'y'
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi r send -X rectangle-toggle

# Paste with prefix + ]
bind ] paste-buffer

# ───────────────────────────────────────────────────────────
# 🤖 AI AGENTS SPECIFIC CONFIGURATIONS
# ───────────────────────────────────────────────────────────

# Quick layout switching for dual agents
bind M-1 select-layout even-horizontal  # Side-by-side agents
bind M-2 select-layout even-vertical    # Stacked agents
bind M-3 select-layout main-horizontal  # One large, one small (horizontal)
bind M-4 select-layout main-vertical    # One large, one small (vertical)
bind M-5 select-layout tiled            # All panes equal size

# Mark panes (useful for agent identification)
bind m select-pane -m  # Mark current pane
bind M select-pane -M  # Unmark pane

# Broadcast mode toggle (for sending commands to all agents)
# Already defined above as 'S'

# Zoom current pane (focus on one agent)
bind z resize-pane -Z

# ───────────────────────────────────────────────────────────
# 🔌 TPM (Tmux Plugin Manager)
# ───────────────────────────────────────────────────────────

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# ───────────────────────────────────────────────────────────
# 🎯 Enhanced Plugins (Added 2025-10-29)
# ───────────────────────────────────────────────────────────

# Advanced session management with fzf integration
set -g @plugin 'omerxx/tmux-sessionx'

# Keyword-based pane navigation (jump to panes by typing keywords)
set -g @plugin 'schasse/tmux-jump'

# General fzf integration for tmux commands
set -g @plugin 'sainnhe/tmux-fzf'

# Fuzzy text extraction from terminal output
set -g @plugin 'laktak/extrakto'

# Visual TUI menu for tmux functions
set -g @plugin 'jaclu/tmux-menus'

# Session manipulation utilities
set -g @plugin 'tmux-plugins/tmux-sessionist'

# Log pane output to file
set -g @plugin 'tmux-plugins/tmux-logging'

# Copy/paste with visual hints
set -g @plugin 'Morantron/tmux-fingers'

# ───────────────────────────────────────────────────────────
# ⚙️ Plugin Configurations
# ───────────────────────────────────────────────────────────

# tmux-resurrect: Session persistence
# Restore vim/neovim sessions
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Capture pane contents
set -g @resurrect-capture-pane-contents 'on'

# Save additional programs
set -g @resurrect-processes 'ssh mysql psql "~npm start" "~python" "~node"'

# tmux-continuum: Automatic session save/restore
# Auto-save every 15 minutes
set -g @continuum-save-interval '15'

# Auto-restore last saved session on tmux start
set -g @continuum-restore 'on'

# Show save status in status bar
set -g @continuum-boot 'on'

# tmux-yank: Clipboard integration
# Use system clipboard
set -g @yank_selection 'clipboard'
set -g @yank_selection_mouse 'clipboard'

# tmux-open: Open files/URLs from tmux
# Open with 'o' in copy mode
set -g @open-S 'https://www.google.com/search?q='

# tmux-prefix-highlight: Show when prefix is active
set -g @prefix_highlight_fg 'black'
set -g @prefix_highlight_bg 'yellow'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow,bold'

# Add prefix highlight to status right
set -g status-right "#{prefix_highlight} #[fg=#50fa7b]  %Y-%m-%d #[fg=#f8f8f2]│#[fg=#8be9fd] 🕐 %H:%M #[fg=#f8f8f2]│#[fg=#ff79c6] 💻 #H "

# ───────────────────────────────────────────────────────────
# 🎯 Enhanced Plugins Configuration (Added 2025-10-29)
# ───────────────────────────────────────────────────────────

# tmux-sessionx: Advanced session management
# Keybinding: prefix + O (capital O)
set -g @sessionx-bind 'O'
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-preview-enabled 'true'
set -g @sessionx-preview-ratio '55%'

# tmux-jump: Keyword navigation
# Keybinding: prefix + j
set -g @jump-key 'j'
# Match whole words
set -g @jump-bg-color '\e[0m\e[90m'
set -g @jump-fg-color '\e[1m\e[31m'

# tmux-fzf: General fzf integration
# Keybinding: prefix + F (capital F)
TMUX_FZF_LAUNCH_KEY="F"
# Use popup if tmux >= 3.2
TMUX_FZF_OPTIONS="-p -w 80% -h 75% -m"
# Dracula color scheme for consistency
TMUX_FZF_PREVIEW_OPTIONS="-w 60%"

# extrakto: Text extraction
# Keybinding: prefix + Tab
set -g @extrakto_key 'tab'
set -g @extrakto_split_size '15'
set -g @extrakto_clip_tool 'auto'
set -g @extrakto_fzf_tool 'fzf'
# Filter order: path/url, word, line, all
set -g @extrakto_filter_order 'path/url word line all'
set -g @extrakto_grab_area 'window full'
set -g @extrakto_popup_size '75%'

# tmux-menus: Visual TUI menu
# Keybinding: prefix + \ (backslash) or Ctrl + \
set -g @menus_trigger 'C-\'
set -g @menus_location_x 'C'
set -g @menus_location_y 'C'

# tmux-sessionist: Session utilities
# Keybindings (prefix +):
#   g - prompts for session name and switches to it
#   C - prompt for creating a new session
#   X - kill current session without detaching tmux
#   S - switch to the last session
#   @ - promote current pane to a new session

# tmux-logging: Pane output logging
# Keybindings (prefix +):
#   shift + p - Toggle logging (save to ~/tmux-logs/)
#   alt + p - Screen capture (save visible pane)
#   alt + shift + p - Save complete pane history
set -g @logging-path "~/tmux-logs"
set -g @logging-filename "tmux-#{session_name}-#{window_index}-#{pane_index}-%Y%m%d-%H%M%S.log"
set -g @screen-capture-path "~/tmux-logs"
set -g @save-complete-history-path "~/tmux-logs"

# tmux-fingers: Hint-based copy/paste
# Keybinding: prefix + F (if not conflicting with tmux-fzf)
# Alternative: prefix + f (lowercase)
set -g @fingers-key 'f'
set -g @fingers-keyboard-layout 'qwerty'
set -g @fingers-hint-format '#[fg=yellow,bold]%s'
set -g @fingers-highlight-format '#[fg=cyan,dim]%s'
set -g @fingers-pattern-0 '[0-9a-f]{7,40}'  # Git commit hashes
set -g @fingers-pattern-1 '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'  # IP addresses
set -g @fingers-pattern-2 '[a-zA-Z0-9_-]+@[a-zA-Z0-9.-]+'  # Email addresses
set -g @fingers-copy-command 'xclip -selection clipboard'

# ───────────────────────────────────────────────────────────
# 💾 AI AGENTS SESSION TEMPLATES
# ───────────────────────────────────────────────────────────

# Quick session layouts for different collaboration modes
# These can be called with: tmux source-file ~/.tmux/layouts/pair-programming.conf

# Create layouts directory on first run
# run-shell "mkdir -p ~/.tmux/layouts"

# ───────────────────────────────────────────────────────────
# 📝 Notes & Tips
# ───────────────────────────────────────────────────────────

# TPM Key Bindings:
# - prefix + I (capital i) - Install plugins
# - prefix + U - Update plugins
# - prefix + alt + u - Uninstall plugins not in config

# Quick Reference:
# - prefix + | - Split vertically
# - prefix + - - Split horizontally
# - Alt + arrows - Navigate panes (no prefix)
# - Shift + arrows - Switch windows (no prefix)
# - prefix + S - Sync panes (broadcast to all)
# - prefix + z - Zoom/unzoom pane
# - prefix + [ - Enter copy mode
# - prefix + r - Reload config

# Session Management:
# - tmux new -s name - Create named session
# - tmux attach -t name - Attach to session
# - tmux ls - List sessions
# - tmux kill-session -t name - Kill session
# - prefix + d - Detach from session
# - prefix + $ - Rename session

# AI Agents Specific:
# - Alt+1-5 - Quick layout switching
# - prefix + m - Mark pane (agent ID)
# - prefix + S - Sync panes (broadcast mode)

# Enhanced Plugins (Added 2025-10-29):
# - prefix + O - Session manager (sessionx) with fzf preview
# - prefix + j - Jump to pane by keyword
# - prefix + F - General fzf menu for tmux operations
# - prefix + Tab - Extract text (paths/URLs/words) with fzf
# - Ctrl + \ - Visual TUI menu for all tmux commands
# - prefix + g - Switch to session by name (sessionist)
# - prefix + C - Create new session (sessionist)
# - prefix + X - Kill session without detaching (sessionist)
# - prefix + Shift+P - Toggle pane logging to ~/tmux-logs/
# - prefix + f - Hint-based copy/paste (fingers)

# Copy Mode & Clipboard:
# - prefix + [ - Enter copy mode
# - v - Begin selection (in copy mode)
# - y - Copy selection to clipboard (in copy mode)
# - prefix + ] - Paste from buffer
# - o - Open selected file/URL (in copy mode, tmux-open)

# Session Persistence (resurrect/continuum):
# - Auto-saves every 15 minutes (continuum)
# - Auto-restores on tmux start (continuum)
# - prefix + Ctrl+s - Manual save session (resurrect)
# - prefix + Ctrl+r - Manual restore session (resurrect)

# ───────────────────────────────────────────────────────────
# 🚀 INITIALIZE TPM (MUST BE AT END OF FILE!)
# ───────────────────────────────────────────────────────────

# Install TPM if not already installed
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TPM (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
